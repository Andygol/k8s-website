---
title: Спостережуваність
reviewers:
weight: 55
content_type: concept
description: >
  Дізнайтеся, як отримати повну наскрізну аналітичну інформацію про кластер Kubernetes за допомогою збору метрик, журналів та трейсів.
no_list: true
card:
  name: setup
  weight: 60
  anchors:
  - anchor: "#metrics"
    title: Метрики
  - anchor: "#logs"
    title: Журнали
  - anchor: "#traces"
    title: Трейси
---

<!-- overview -->

В Kubernetes спостережуваність — це процес збору та аналізу метрик, журналів і трейсів, часто їх називають трьома стовпами спостережуваності, з метою отримання кращого розуміння внутрішнього стану, продуктивності та справності кластера.

Панель управління Kubernetes, так само як і багато надбудов, генеруює та надсилає ці сигнали. Обʼєднуючи та корелюючи їх, ви можете отримати єдину картину панелі управління, надбудов і застосунків у вашому кластері.

На малюнку 1 показано, як компоненти кластера формують три основні типи сигналів.

{{< mermaid >}}
flowchart LR
    A[Компоненти<br/>кластера] --> M[Потік метрик]
    A --> L[Потік журналів]
    A --> T[Потік трейсів]
    M --> S[(Збереження та<br/>аналіз)]
    L --> S
    T --> S
    S --> O[Оператори та<br/>автоматизація]
{{< /mermaid >}}

*Малюнок 1. Сигнали високого рівня, що надходять від компонентів кластера та їх користувачів.*

<!-- body -->
## Метрики {#metrics}

Компоненти Kubernetes генерують метрики у форматі [Prometheus](https://prometheus.io/docs/instrumenting/exposition_formats/) на їх точках доступу `/metrics`, включаючи:

- kube-controller-manager
- kube-proxy
- kube-apiserver
- kube-scheduler
- kubelet

Kubelet також надає метрики на `/metrics/cadvisor`, `/metrics/resource` та `/metrics/probes`, а надбудови, такі як [kube-state-metrics](/docs/concepts/cluster-administration/kube-state-metrics/), збагачують ці сигнали панелі управління статусом обʼєктів Kubernetes.

Типовий потік метрик Kubernetes періодично зчитує ці точки доступу та зберігає відібрані частинки в базі даних часових рядів (приклад з Prometheus).

Дивіться [посібник з системних метрик](/docs/concepts/cluster-administration/system-metrics/) для отримання додаткової інформації та параметрів конфігурації.

Малюнок 2 показує типовий потік метрик Kubernetes.

{{< mermaid >}}
flowchart LR
    C[Компоненти<br/>кластера] --> P[Збирач<br/>Prometheus]
    P --> TS[(Сховище<br/>часових рядів)]
    TS --> D[Панелі моніторингу<br/>та сповіщення]
    TS --> A[Автоматизовані дії]
{{< /mermaid >}}

*Малюнок 2. Компоненти типового потоку метрик Kubernetes.*

Для спостережуваності в умовах багатокластерного або багатохмарного середовища розподілені бази даних часових рядів (наприклад, Thanos або Cortex) можуть доповнити Prometheus.

Подивіться [Загальні інструменти спостережуваності — інструменти метрик](#metrics-tools) для отримання інформації щодо інструментів збору метрик і баз даних часових рядів.

#### {{% heading "seealso" %}}

- [Системні метрики компонентів Kubernetes](/docs/concepts/cluster-administration/system-metrics/)
- [Моніторинг використання ресурсів за допомогою metrics-server](/docs/tasks/debug/debug-cluster/resource-usage-monitoring/)
- [Концепція kube-state-metrics](/docs/concepts/cluster-administration/kube-state-metrics/)
- [Огляд конвеєра метрик ресурсів](/docs/tasks/debug/debug-cluster/resource-metrics-pipeline/)

## Логи {#logs}

Логи дозволять отримати хронологічні записи подій всередині застосунків, компонентів системи Kubernetes та діяльності, повʼязаної з безпекою, такої як журнали аудиту.

Середовища виконання контейнерів захоплюють вивід контейнеризованого застосунку з потоків стандартного виводу (`stdout`) та стандартних виводу помилок (`stderr`). Хоча середовища виконання реалізують це по-різному, інтеграція з kubelet стандартизована через _формат логування CRI_, а kubelet робить ці логи доступними через `kubectl logs`.

![Отримання логів на рівні вузла](/images/docs/user-guide/logging/logging-node-level.png)

*Малюнок 3a. Архітектура отримання логів на рівні вузла.*

Логи компонентів системи захоплюють події з кластера і часто корисні для налагодження та усунення несправностей. Ці компоненти класифікуються двома різними способами: ті, що працюють у контейнері, і ті, що працюють поза контейнером. Наприклад, `kube-scheduler` і `kube-proxy` зазвичай працюють у контейнерах, тоді як `kubelet` і середовище виконання контейнерів працюють безпосередньо на хості.

- На машинах з `systemd` kubelet і середовище виконання контейнерів пишуть у journald. В іншому випадку вони виконують запис у `.log` файли в теці `/var/log`.
- Системні компоненти, які працюють у контейнерах, завжди пишуть у `.log` файли в `/var/log`, обходячи стандартний механізм ведення журналів контейнерів.

Логи компонентів системи та контейнерів, що зберігаються в теці `/var/log`, потребують ротації, щоб запобігти неконтрольованому зростанню. Деякі сценарії розгортання кластерів стандартно встановлюють ротацію журналів; перевірте своє середовище та налаштуйте його за потреби. Дивіться [довідку щодо системних журналів](/docs/concepts/cluster-administration/system-logs/) для отримання додаткової інформації про розташування, формати та параметри конфігурації.

Більшість кластерів запускають агента ведення журналів на рівні вузла (наприклад, Fluent Bit або Fluentd), який стежить за цими файлами та пересилає записи до центрального сховища журналів. [Посібник з архітектури ведення журналів](/docs/concepts/cluster-administration/logging/) пояснює, як проєктувати такі конвеєри, застосовувати утримання та реєструвати потоки в бекендах.

Малюнок 3 описує типовий конвеєр агрегації логів.

{{< mermaid >}}
flowchart LR
    subgraph Джерела
        A[Вівід застосунку<br/>в stdout / stderr]
        B[Логи<br/>панелі<br/>управління]
        C[Записи аудиту]
    end
    A --> N[Агент<br/>ведення журналів<br/>на рівні вузла]
    B --> N
    C --> N
    N --> L[Центральне<br/>сховище<br/>журналів]
    L --> Q[Дашборди,<br/>сповіщення,<br/>SIEM]
{{< /mermaid >}}

*Малюнок 3. Компоненти стандартного конвеєра журналів Kubernetes.*

Подивіться [Загальні інструменти спостережуваності — інструменти ведення журналів](#logging-tools) для отримання відомостей про агентів ведення журналів та центральні сховища журналів.

#### {{% heading "seealso" %}}

- [Архітектура ведення журналів](/docs/concepts/cluster-administration/logging/)
- [Системні журнали](/docs/concepts/cluster-administration/system-logs/)
- [Завдання та посібники з ведення журналів](/docs/tasks/debug/logging/)
- [Налаштування ведення журналів аудиту](/docs/tasks/debug/debug-cluster/audit/)

## Трейси {#traces}

Трейси фіксують, як запити переміщуються між компонентами та застосунками Kubernetes, повʼязуючи затримки, час та взаємозвʼязки між операціями. Збираючи трейси, ви можете візуалізувати потік запитів від початку до кінця, діагностувати проблеми з продуктивністю та виявляти вузькі місця або несподівані взаємодії в панелі управління, надбудовах або застосунках.

Kubernetes {{< skew currentVersion >}} може експортувати відрізки (span) використовуючи [OpenTelemetry Protocol](/docs/concepts/cluster-administration/system-traces/) (OTLP), або безпосередньо через вбудовані gRPC експортери, або пересилаючи їх через OpenTelemetry Collector.

OpenTelemetry Collector отримує відрізки від компонентів та застосунків, обробляє їх (наприклад, застосовуючи відбір або редагування) і пересилає їх до бекенду трасування для зберігання та аналізу.

Малюнок 4 описує типовий конвеєр розподіленого трасування.

{{< mermaid >}}
flowchart LR
    subgraph Джерела
        A[Відрізки<br/>панелі управління]
        B[Відрізки<br/>застосунків]
    end
    A --> X[OTLP exporter]
    B --> X
    X --> COL[OpenTelemetry<br/>Collector]
    COL --> TS[(Бекенд<br/>трасування)]
    TS --> V[Візуалізація<br/>та аналіз]
{{< /mermaid >}}

*Малюнок 4. Компоненти стандартного конвеєра трасування Kubernetes.*

Подивіться [Загальні інструменти спостережуваності — інструменти трасування](#tracing-tools) для отримання відомостей про колектори трасування та бекенди.

#### {{% heading "seealso" %}}

- [Системні відрізки для компонентів Kubernetes](/docs/concepts/cluster-administration/system-traces/)
- [Посібник з налаштування OpenTelemetry Collector](https://opentelemetry.io/docs/collector/getting-started/)
- [Завдання з моніторингу та трасування](/docs/tasks/debug/monitoring/)

## Загальні інструменти спостережуваності {#common-observability-tools}

{{% thirdparty-content %}}

### Інструменти метрик {#metrics-tools}

- [Cortex](https://cortexmetrics.io/) пропонує горизонтально масштабоване, довгострокове сховище Prometheus.
- [Grafana Mimir](https://grafana.com/oss/mimir/) — проєкт Grafana Labs, який надає багатокористувацьке, горизонтально масштабоване сховище, сумісне з Prometheus.
- [Prometheus](https://prometheus.io/) — це система моніторингу, яка збирає та зберігає метрики з компонентів Kubernetes.
- [Thanos](https://thanos.io/) розширює Prometheus механізмом глобальних запитів, зменшуючи дисковий простір та додаючи підтримку обʼєктного зберігання.

### Інструменти журналювання {#logging-tools}

- [Elasticsearch](https://www.elastic.co/elasticsearch/) забезпечує розподілену індексацію та пошук в журналах.
- [Fluent Bit](https://fluentbit.io/) збирає та пересилає журнали контейнерів і вузлів з низьким споживанням ресурсів.
- [Fluentd](https://www.fluentd.org/) маршрутизує та трансформує журнали до кількох місць призначення.
- [Grafana Loki](https://grafana.com/oss/loki/) зберігає журнали у форматі, на основі міток, подібному до Prometheus.
- [OpenSearch](https://opensearch.org/) інструмент з відкритим кодом, що надає індексування та пошук в логах, сумісний з API Elasticsearch.

### Інструменти трасування {#tracing-tools}

- [Grafana Tempo](https://grafana.com/oss/tempo/) пропонує масштабоване, розподілене зберігання трасувань, що не потребує високих витрат.
- [Jaeger](https://www.jaegertracing.io/) збирає та візуалізує розподілені трасування для мікросервісів.
- [OpenTelemetry Collector](https://opentelemetry.io/docs/collector/) отримує, обробляє та експортує телеметричні дані, включаючи трасування.
- [Zipkin](https://zipkin.io/) забезпечує збір та візуалізацію розподілених трасувань.

## {{% heading "whatsnext" %}}

- Дізнайтесь як [збирати метрики використання ресурсів за допомогою metrics-server](/docs/tasks/debug/debug-cluster/resource-usage-monitoring/)
- Подивіться [завдання та посібники з журналювання](/docs/tasks/debug/logging/)
- Спробуйте виконати [завдання з моніторингу та трасування](/docs/tasks/debug/monitoring/)
- Ознайомтесь з [посібником по системних метриках](/docs/concepts/cluster-administration/system-metrics/) для отримання відомостей про точки доступу компонентів та їх стабільність
- Ознайомтесь з розділом [загальні інструменти спостережуваності](#common-observability-tools) для перевірених сторонніх варіантів
